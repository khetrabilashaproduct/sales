<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance-Graph | Khetra Bilasha Products</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
        /* Body Styling */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #E6E6FA;
            margin: 0;
            padding: 0;
            color: #333;
          
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            overflow-x: hidden; /* Prevent horizontal overflow */
        }
        .on-hold-details {
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    max-width: 90%;
    overflow-y: auto;
}

.on-hold-item {
    margin-bottom: 10px;
}

.on-hold-details h3 {
    font-size: 1.5rem;
    color: #333;
    margin-bottom: 15px;
}

.on-hold-details p {
    font-size: 1.2rem;
    color: #333;
}

button {
    margin-top: 20px;
}


        /* Header and Logo Styling */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 2rem;
        }

        .logo-container {
            height: 100px;
            justify-content: center;
            width: 40%;
            box-shadow: 10px 8px 15px rgba(255, 0, 0, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            animation: slideIn 1s ease-out;
        }

        .logo {
            border-radius: 10px;
            width: 60px; /* Logo size */
            height: 60px;
            margin-right: 10px;
        }

        h1 {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
            margin: 0;
            animation: fadeIn 1s ease-out;
        }

        /* Animation for logo and text */
        @keyframes slideIn {
            from {
                transform: translateX(-50px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        .years{
            visibility: hidden;
        }
        /* Charts Container */
        #charts-container {
            display: flex;
    flex-direction: row;
    width: 100%;
    height: 100vh;
    overflow-x: hidden;
    scroll-snap-type: x mandatory;
        }

        .chart-row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    margin-bottom: 30px;
}


.chart-slide {
    flex: 0 0 100%;
    scroll-snap-align: center;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
}
/* Navigation Buttons */
.nav-buttons {
    position: fixed;
    bottom: 10%;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
}

.nav-button {
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.nav-button:hover {
    background-color: #0056b3;
}

        /* Filter Section */
        .filter-section {
            text-align: center;
            margin-bottom: 2rem;
        }
       
        /* Input Styling */
        input[type="text"] {
            text-align: center;
            border-radius: 15px;
            padding: 10px;
            margin: 5px;
            width: 160px;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
            
        }

        input[type="text"]:focus {
            border-color: #007bff;
            outline: none;
        }

        /* Button Styling */
        #move-button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            background-color: #29AB87;
            color: black;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
        }

        /* Button Hover Animation */
        #move-button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }

        /* Animations for Charts */
        .chart-card {
    flex: 1 1 calc(33.33% - 40px); /* Adjust for 3 graphs per row */
    max-width: calc(33.33% - 40px);
    min-width: 300px; /* Ensure minimum size for smaller screens */
}

        .moved {
            transform: translateY(50px);
        }
        .text-muted{
            box-shadow: 10px 8px 15px rgba(255, 0, 0, 0.1);
            border-radius: 15px;
            padding: 10px;
            margin: 5px;
            width: 150px;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
        }
        @media (max-width: 768px) {
            .logo-container {
            height: 200px;
            width: 50%;
          
        }
  
        }
       

    </style>
</head>
<body>
    <div class="container my-5">
        <header>
            <div class="logo-container">
                <img src="https://khetrabilashaproduct.github.io/sales/logo.png" class="logo" alt="Company Logo">
                <h1>Khetra Bilasha Products Dashboard</h1>
            </div>
            <p id="current-date" class="text-muted"></p>
        </header>

        <div class="filter-section">
            <label class="selectdate" for="month-picker">Select Date:</label>
            <input class="selectdate1" type="text" id="month-picker" placeholder="Pick a Month">
            <label class="years" for="year-picker">Select Year:</label>
            <input class="years" type="text" id="year-picker" placeholder="Pick a Year">
            <div id="selected-month-year"></div>
        </div>

        <!-- Button to Move Graph -->
        <button id="move-button" class="btn btn-primary">Move Last Graph</button>

        <div id="charts-container">
            <!-- Charts will be dynamically added here -->
        </div>
    </div>

    <script>

        
document.addEventListener('DOMContentLoaded', async () => {
    const currentDate = new Date().toISOString().split('T')[0];
    const currentMonth = currentDate.slice(0, 7);
    const currentYear = currentDate.slice(0, 4);
    const currentDay = currentDate.slice(0, 10);

    document.getElementById('current-date').innerText = `Date: ${new Date().toLocaleDateString()}`;
    const chartsContainer = document.getElementById('charts-container');

    // Create slider structure
    const dailySlide = document.createElement('div');
    dailySlide.classList.add('chart-slide');
    dailySlide.id = 'daily-slide';

    const monthlySlide = document.createElement('div');
    monthlySlide.classList.add('chart-slide');
    monthlySlide.id = 'monthly-slide';

    const yearlySlide = document.createElement('div');
    yearlySlide.classList.add('chart-slide');
    yearlySlide.id = 'yearly-slide';

    chartsContainer.appendChild(dailySlide);
    chartsContainer.appendChild(monthlySlide);
    chartsContainer.appendChild(yearlySlide);

    // Add navigation buttons
    const navButtons = document.createElement('div');
    navButtons.classList.add('nav-buttons');

    const prevButton = document.createElement('button');
    prevButton.classList.add('nav-button');
    prevButton.innerText = 'Previous';

    const nextButton = document.createElement('button');
    nextButton.classList.add('nav-button');
    nextButton.innerText = 'Next';

    navButtons.appendChild(prevButton);
    navButtons.appendChild(nextButton);
    document.body.appendChild(navButtons);

    // Slide navigation logic
    let currentSlideIndex = 0;
    const slides = [dailySlide, monthlySlide, yearlySlide];

    const updateSlideVisibility = () => {
        slides.forEach((slide, index) => {
            slide.style.display = index === currentSlideIndex ? 'flex' : 'none';
        });
    };

    prevButton.addEventListener('click', () => {
        currentSlideIndex = (currentSlideIndex - 1 + slides.length) % slides.length;
        updateSlideVisibility();
    });

    nextButton.addEventListener('click', () => {
        currentSlideIndex = (currentSlideIndex + 1) % slides.length;
        updateSlideVisibility();
    });

    updateSlideVisibility();

    const fetchDataForDay = async (day) => {
        const filePath = `data/${day.slice(0, 4)}/${day.slice(5, 7)}/${day.slice(8, 10)}.json`;
        const response = await fetch(filePath);
        if (!response.ok) return [];
        const json = await response.json();
        return json.sales || [];
    };

    const fetchDataForMonth = async (month) => {
        const filePath = `data/${month.slice(0, 4)}/${month.slice(5, 7)}.json`;
        const response = await fetch(filePath);
        if (!response.ok) return [];
        const json = await response.json();
        return json.sales || [];
    };

    const fetchYearlyData = async (year) => {
        let yearlyData = [];
        for (let month = 1; month <= 12; month++) {
            const formattedMonth = `${year}-${String(month).padStart(2, '0')}`;
            const data = await fetchDataForMonth(formattedMonth);
            yearlyData.push(...data);
        }
        return yearlyData;
    };

    const renderDailyCharts = (salesData, container) => {
        container.innerHTML = '';

        const dailySales = {};
        const dailyOnHold = {};
        const dailyPaid = {};

        salesData.forEach(sale => {
            const dayKey = sale.date;

            dailySales[dayKey] = (dailySales[dayKey] || 0) + sale.amount;
            dailyOnHold[dayKey] = (dailyOnHold[dayKey] || 0) + sale.onHold;
            dailyPaid[dayKey] = (dailyPaid[dayKey] || 0) + sale.totalPaid;
        });

        renderChart('Daily Sales', 'bar', Object.keys(dailySales), Object.values(dailySales), container, 'Total sales per day.');
        renderChart('On-Hold (Daily)', 'bar', Object.keys(dailyOnHold), Object.values(dailyOnHold), container, 'On-hold amounts per day.');
        renderChart('Total Received (Daily)', 'bar', Object.keys(dailyPaid), Object.values(dailyPaid), container, 'Total payments received per day.');
    };

    const renderMonthlyCharts = (salesData, container) => {
        container.innerHTML = '';

        const monthlySales = {};
        const monthlyOnHold = {};
        const monthlyPaid = {};

        salesData.forEach(sale => {
            const monthKey = sale.date.slice(0, 7);

            monthlySales[monthKey] = (monthlySales[monthKey] || 0) + sale.amount;
            monthlyOnHold[monthKey] = (monthlyOnHold[monthKey] || 0) + sale.onHold;
            monthlyPaid[monthKey] = (monthlyPaid[monthKey] || 0) + sale.totalPaid;
        });

        renderChart('Monthly Sales', 'bar', Object.keys(monthlySales), Object.values(monthlySales), container, 'Total sales per month.');
        renderChart('On-Hold (Monthly)', 'bar', Object.keys(monthlyOnHold), Object.values(monthlyOnHold), container, 'On-hold amounts per month.');
        renderChart('Total Received (Monthly)', 'bar', Object.keys(monthlyPaid), Object.values(monthlyPaid), container, 'Total payments received per month.');
    };

    const renderYearlyCharts = (salesData, container) => {
        container.innerHTML = '';

        const yearlySales = {};
        const yearlyOnHold = {};
        const yearlyPaid = {};

        salesData.forEach(sale => {
            const yearKey = sale.date.slice(0, 4);

            yearlySales[yearKey] = (yearlySales[yearKey] || 0) + sale.amount;
            yearlyOnHold[yearKey] = (yearlyOnHold[yearKey] || 0) + sale.onHold;
            yearlyPaid[yearKey] = (yearlyPaid[yearKey] || 0) + sale.totalPaid;
        });

        renderChart('Yearly Sales', 'pie', Object.keys(yearlySales), Object.values(yearlySales), container, 'Total sales per year.');
        renderChart('On-Hold (Yearly)', 'pie', Object.keys(yearlyOnHold), Object.values(yearlyOnHold), container, 'On-hold amounts per year.');
        renderChart('Total Received (Yearly)', 'pie', Object.keys(yearlyPaid), Object.values(yearlyPaid), container, 'Total payments received per year.');
    };

    const renderChart = (title, type, labels, data, container, description) => {
        const card = document.createElement('div');
        card.classList.add('chart-card');

        const canvas = document.createElement('canvas');
        card.appendChild(canvas);

        const desc = document.createElement('p');
        desc.innerText = description;
        desc.style.textAlign = 'center';
        desc.style.marginTop = '10px';
        card.appendChild(desc);

        container.appendChild(card);

        new Chart(canvas, {
            type: type,
            data: {
                labels: labels,
                datasets: [{
                    label: title,
                    data: data,
                    borderColor: '#004953',
                    backgroundColor: '#50C878',
                    fill: true
                }]
            }
        });
    };

    const defaultDayData = await fetchDataForDay(currentDay);
    const defaultMonthData = await fetchDataForMonth(currentMonth);
    const defaultYearData = await fetchYearlyData(currentYear);

    renderDailyCharts(defaultDayData, dailySlide);
    renderMonthlyCharts(defaultMonthData, monthlySlide);
    renderYearlyCharts(defaultYearData, yearlySlide);

    // Initialize Flatpickr for month selection
    flatpickr("#month-picker", {
        dateFormat: "Y-m",
        defaultDate: currentMonth,
        onChange: async (selectedDates, dateStr) => {
            const selectedMonth = dateStr;
            const monthlyData = await fetchDataForMonth(selectedMonth);
            renderMonthlyCharts(monthlyData, document.getElementById('monthly-slide'));
        },
    });

    // Initialize Flatpickr for year selection (if needed)
    flatpickr("#year-picker", {
        dateFormat: "Y",
        defaultDate: currentYear,
        onChange: async (selectedDates, dateStr) => {
            const selectedYear = dateStr;
            const yearlyData = await fetchYearlyData(selectedYear);
            renderYearlyCharts(yearlyData, document.getElementById('yearly-slide'));
        },
    });
});


    </script>
    
</body>
</html>
